Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_Dialogs(CHARACTERGUID_TRHU_Wik_001_59b9a307-385c-4712-af66-fda25a396f7d, "WikReturnFromDemonCave");
DB_Dialogs(CHARACTERGUID_TRHU_Wik_001_59b9a307-385c-4712-af66-fda25a396f7d, "WikDemonCampQuest");
KBSECTION
IF
CharacterEnteredTrigger(_character, TRIGGERGUID_StartWIkConversationEventTrigger_ea4d3967-ac6d-430f-8eeb-82c9bdd7223b)
AND
GlobalGetFlag("ACCEPTEDSWAMPQUEST", 0)
AND
CharacterIsInCombat(_character, 0)
THEN
CharacterMoveToAndTalk(CHARACTERGUID_TRHU_Wik_001_59b9a307-385c-4712-af66-fda25a396f7d, _character, "WikDemonCampQuest", 1, "", 0, 20.0);
SetOnStage(CHARACTERGUID_TRHU_Mud_Turtle_000_5ad81ccd-dd2e-47b9-989a-b005b08000e2, 0);
SetOnStage(CHARACTERGUID_TRHU_Mud_Turtle_001_aba26ae2-208f-4915-b5f9-6d03477c3ea6, 0);
SetOnStage(CHARACTERGUID_TRHU_Mud_Turtle_002_35fda9a9-b933-46f8-bf29-1423cd380a62, 0);
SetOnStage(CHARACTERGUID_TRHU_Ursala_000_fa67c3cb-2d10-4daa-80f4-ce3c595a94d4, 0);
//PartyAddExperience(_character, 1, 1, 200);

IF
CharacterEnteredTrigger(_character, TRIGGERGUID_StartWIkConversationEventTrigger_ea4d3967-ac6d-430f-8eeb-82c9bdd7223b)
AND
GlobalGetFlag("ACCEPTEDSWAMPQUEST", 1)
THEN
CharacterMoveToAndTalk(CHARACTERGUID_TRHU_Wik_001_59b9a307-385c-4712-af66-fda25a396f7d, _character, "WikReturnFromDemonCave", 1, "", 0, 20.0);


IF
GlobalFlagSet("ACCEPTEDSWAMPQUEST")
THEN
CharacterTeleportPartiesToTrigger(TRIGGERGUID_CrateDarkRoomTeleportTrigger_4170c4dc-b4a2-46a1-94c0-4efc96dbdea0, "");
AutoSave();
TimerLaunch("GoingToSwamp", 5000);

IF
TimerFinished("GoingToSwamp")
THEN
CharacterTeleportPartiesToTrigger(TRIGGERGUID_SwampTeleportTrigger_bd771015-6076-4a3b-90fb-d5ec11c1f8be, "");

IF
GlobalFlagSet("CHOSETODIE")
THEN
SetFaction(CHARACTERGUID_Wik_Guard_003_e59ab21d-cc58-4250-828a-fd36ad57d38a, "Evil NPC");
SetFaction(CHARACTERGUID_Wik_Guard_004_04c9acff-4879-4466-aaf5-74d701a945e0, "Evil NPC");
SetFaction(CHARACTERGUID_TRHU_Wik_001_59b9a307-385c-4712-af66-fda25a396f7d, "Evil NPC");

IF
GlobalFlagSet("DEMONCAVEQUESTENDED")
THEN
CharacterMoveTo(CHARACTERGUID_TRHU_Wik_001_59b9a307-385c-4712-af66-fda25a396f7d, TRIGGERGUID_WIkWalkAwayPointAfterDemonCavePointTrigger_0bf627ff-62fa-40ce-b7f5-7ebb9b482eef, 0, "", 0);
TimerLaunch("WikLeaveGoToDukeLevel", 5000);

IF
TimerFinished("WikLeaveGoToDukeLevel")
THEN
//CharacterTeleportPartiesToTrigger(TRIGGERGUID_DukeLevelTeleportTrigger_272688f3-e33a-451f-b1a2-a37e8d404ea6, "");
CharacterTeleportPartiesToTrigger(TRIGGERGUID_WikCellDukeLevelTeleportTrigger_fb27f155-5274-43f1-ac81-434caad12e26, "");


IF
GlobalFlagSet("FAILEDDEMONCAVEQUEST")
THEN
SetFaction(CHARACTERGUID_Wik_Guard_003_e59ab21d-cc58-4250-828a-fd36ad57d38a, "Evil NPC");
SetFaction(CHARACTERGUID_Wik_Guard_004_04c9acff-4879-4466-aaf5-74d701a945e0, "Evil NPC");
SetFaction(CHARACTERGUID_TRHU_Wik_001_59b9a307-385c-4712-af66-fda25a396f7d, "Evil NPC");
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "PaymentFailed"
